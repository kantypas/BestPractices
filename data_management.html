

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Data Management &mdash; Cross Facility Workflows 0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Containers" href="containers.html" />
    <link rel="prev" title="Cross Facility Workflows" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Cross Facility Workflows
          

          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Technologies</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#globus">Globus</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#alcf">ALCF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nersc">NERSC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#olcf">OLCF</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#datafed">DataFed</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#command-line-interface">Command Line Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#python-api">Python API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="containers.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_applications.html">Workflow Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="facility_api.html">APIs for Facilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="identity_management.html">Identity Management</a></li>
</ul>
<p class="caption"><span class="caption-text">Use cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cctbx.html">Using CCTBX in a Superfacility Workflow</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebooks/example/index.html">Example</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cross Facility Workflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Data Management</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/data_management.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="data-management">
<h1>Data Management<a class="headerlink" href="#data-management" title="Permalink to this headline">¶</a></h1>
<p>This page documents for users how to transfer data between the three ASCR Facilities.
We also provide guidance on what storage endpoints are available across the ASCR facilities.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Under construction</p>
</div>
<div class="section" id="globus">
<h2>Globus<a class="headerlink" href="#globus" title="Permalink to this headline">¶</a></h2>
<div class="section" id="alcf">
<h3>ALCF<a class="headerlink" href="#alcf" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.alcf.anl.gov/support-center/theta/using-globus-theta">https://www.alcf.anl.gov/support-center/theta/using-globus-theta</a></p>
<p><a class="reference external" href="https://www.alcf.anl.gov/support-center/cooley/globus-cooley">https://www.alcf.anl.gov/support-center/cooley/globus-cooley</a></p>
</div>
<div class="section" id="nersc">
<h3>NERSC<a class="headerlink" href="#nersc" title="Permalink to this headline">¶</a></h3>
<p>You can log into the Globus web interface with your NERSC credentials (by selecting NERSC in the drop down menu of supported identity providers)
or using many of the other supported providers listed that you can authenticate against.
NERSC maintains several Globus endpoints that can be activated for individual use by any NERSC user.
The list of endpoints are provided in the table below.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 52%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Endpoint Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Recommended Use</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NERSC DTN</p></td>
<td><p>Multi-node, high performance transfer system
with access to all NERSC Global File
systems (NGF) as well as Cori Scratch</p></td>
<td><p>Almost all data transfers
needs into &amp; out of NERSC</p></td>
</tr>
<tr class="row-odd"><td><p>NERSC HPSS</p></td>
<td><p>Single node system connected directly to
the NERSC HPSS tape archive</p></td>
<td><p>Remote transfers into &amp;
out of HPSS</p></td>
</tr>
<tr class="row-even"><td><p>NERSC SHARE</p></td>
<td><p>Single node system with read-only access to
some NERSC file systems</p></td>
<td><p>Shared Globus endpoint</p></td>
</tr>
<tr class="row-odd"><td><p>NERSC S3</p></td>
<td><p>Single node system with read-only
access to NERSC homes</p></td>
<td><p>Data transfers to  &amp; from
Amazon S3</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Data can be shared at NERSC using <a class="reference external" href="https://www.globus.org/data-sharing">Globus Sharing</a>. Currently shared endpoints are read-only, no writing is allowed. See <a class="reference external" href="https://docs.nersc.gov/services/globus/#sharing-data-with-globus">this page</a> for more information.</p></li>
<li><p>NERSC has an experimental Globus S3 endpoint that can be used to access and share content from AWS S3. See <a class="reference external" href="https://docs.nersc.gov/services/globus/#globus-s3-endpoint">this page</a> for more information.</p></li>
</ul>
</div>
<div class="section" id="olcf">
<h3>OLCF<a class="headerlink" href="#olcf" title="Permalink to this headline">¶</a></h3>
<p>OLCF uses Globus for large bulk transfers into and out of the facility.
Documentation is available for <a class="reference external" href="https://docs.olcf.ornl.gov/data/transferring.html#using-globus-from-your-local-machine">transfers from personal computing devices</a> as well as endpoints from one facility to another.
See <a class="reference external" href="https://docs.olcf.ornl.gov/data/transferring.html">this page</a> for more information.</p>
<p>The recommendation to transfer files in and out of OLCF is to begin from the external site, and tar files before executing a transfer between endpoints.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 52%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Endpoint Name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Recommended Use</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>OLCF DTN</p></td>
<td><p>Multi-node, high performance transfer system
with access to OLCF centewide file system</p></td>
<td><p>Almost all data transfers
needs into &amp; out of OLCF</p></td>
</tr>
<tr class="row-odd"><td><p>OLCF HPSS</p></td>
<td><p>Single node system connected directly to
the NERSC HPSS tape archive</p></td>
<td><p>Remote transfers into &amp;
out of HPSS</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="datafed">
<h2>DataFed<a class="headerlink" href="#datafed" title="Permalink to this headline">¶</a></h2>
<img alt="_images/Cross_Facility_Federation_of_Repositories.png" src="_images/Cross_Facility_Federation_of_Repositories.png" />
<p>DataFed is scientific data management and collaboration system that dramatically
simplifies tasks such as organizing, searching for, sharing, discovering, and reusing data
, especially across facilities and organizations.
This is made possible because DataFed “federates” repositories of data into a single, cohesive, and uniform platform.
DataFed was designed to enhance  productivity and reproducibility in scientific research,
keeping the increasingly global and multidisciplinary nature of research involving “big data” in mind.
DataFed supports the early lifecycle stages of “working” scientific data and serves as a tool to ease the burden associated with capturing,
organizing, and sharing potentially large volumes of heterogeneous scientific data.
DataFed provides a FAIR-principled environment in which scientific data can be precisely controlled and refined in preparation for eventual data publishing.
DataFed can be accessed via a <a class="reference external" href="https://datafed.ornl.gov">web portal</a> or via
<a class="reference external" href="https://ornl.github.io/DataFed/user/cli/guide.html">command-line</a> and <a class="reference external" href="https://ornl.github.io/DataFed/user/python/high_level_guide.html">python application programming interfaces</a>.</p>
<p>See <a class="reference external" href="https://ornl.github.io/DataFed/">this page</a> for more detailed documentation, YouTube videos, Jupyter notebooks, user guides, API reference etc.</p>
<p>Upon completing the necessary steps to <a class="reference external" href="https://ornl.github.io/DataFed/system/getting_started.html">prepare</a>,
<a class="reference external" href="https://ornl.github.io/DataFed/user/client/install.html">install and configure</a> DataFed, users can start using DataFed to manage their data:</p>
<div class="section" id="command-line-interface">
<h3>Command Line Interface<a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h3>
<p>Accessing the the CLI in interactive mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ datafed
Welcome to DataFed CLI, version <span class="m">1</span>.1.0:0
Authenticated as u/user123
Use <span class="s1">&#39;exit&#39;</span> <span class="nb">command</span> or Ctrl-C to <span class="nb">exit</span> shell.
</pre></div>
</div>
<p>Creating a Data Record that will contain rich scientific metadata, provenance information, etc.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root&gt; data create <span class="se">\</span>
--alias <span class="s2">&quot;record_from_nersc&quot;</span> <span class="se">\ </span><span class="c1"># Optional argument</span>
--description <span class="s2">&quot;Data and metadata created at NERSC&quot;</span> <span class="se">\ </span><span class="c1"># Optional argument</span>
--metadata-file ./nersc_md.json <span class="se">\ </span><span class="c1"># Optional argument</span>
<span class="s2">&quot;First record created at NERSC using DataFed CLI&quot;</span> <span class="c1"># Title is required though</span>

ID:            d/31030353
Alias:         record_from_nersc
Title:         First record created at NERSC using DataFed CLI
Data Size:     <span class="m">0</span>
Data Repo ID:  repo/cades-cnms
Source:        <span class="o">(</span>none<span class="o">)</span>
Owner:         somnaths
Creator:       somnaths
Created:       <span class="m">11</span>/25/2020,08:04
Updated:       <span class="m">11</span>/25/2020,08:04
Description:   Data and metadata created at NERSC
</pre></div>
</div>
<p>Uploading data in the local file system to remote DataFed data repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root&gt; data put <span class="se">\</span>
--wait <span class="se">\ </span><span class="c1"># optional - wait until Globus transfer completes</span>
<span class="s2">&quot;record_from_nersc&quot;</span> <span class="se">\ </span><span class="c1"># optional - (unique) alias of record</span>
./nersc_data.txt <span class="c1"># path to data</span>

Task ID:             task/31030394
Type:                Data Put
Status:              Succeeded
Started:             <span class="m">11</span>/25/2020,08:05
Updated:             <span class="m">11</span>/25/2020,08:05
</pre></div>
</div>
<p>For more examples, please see the <a class="reference external" href="https://ornl.github.io/DataFed/user/cli/guide.html">user guide for the DataFed CLI</a>.</p>
</div>
<div class="section" id="python-api">
<h3>Python API<a class="headerlink" href="#python-api" title="Permalink to this headline">¶</a></h3>
<p>Import the package and instantiate the messaging client to communicate with the DataFed
server:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datafed.CommandLib</span> <span class="kn">import</span> <span class="n">API</span>
<span class="n">df_api</span> <span class="o">=</span> <span class="n">API</span><span class="p">()</span>
</pre></div>
</div>
<p>Prepare (fake) scientific metadata that would go into a Data Record:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
              <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
              <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mf">7.123</span><span class="p">],</span>
              <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;Something important&#39;</span><span class="p">,</span>
              <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">19</span><span class="p">}</span> <span class="c1"># Can use nested dictionaries</span>
              <span class="p">}</span>
</pre></div>
</div>
<p>Create the Data Record:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dc_resp</span> <span class="o">=</span> <span class="n">df_api</span><span class="o">.</span><span class="n">dataCreate</span><span class="p">(</span><span class="s1">&#39;my important data&#39;</span><span class="p">,</span>
                            <span class="n">metadata</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">parameters</span><span class="p">),</span>
                            <span class="n">parent_id</span><span class="o">=</span><span class="n">dest_collection</span><span class="p">,</span> <span class="c1"># parent collection</span>
                            <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dc_resp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(data {
  id: &quot;d/34682319&quot;
  title: &quot;Some new title for the data&quot;
  alias: &quot;my_first_dataset&quot;
  repo_id: &quot;repo/cades-cnms&quot;
  size: 0.0
  ext_auto: true
  ct: 1611077217
  ut: 1611077220
  owner: &quot;p/trn001&quot;
  creator: &quot;u/somnaths&quot;
  notes: 0
}
update {
  id: &quot;d/34682319&quot;
  title: &quot;Some new title for the data&quot;
  alias: &quot;my_first_dataset&quot;
  owner: &quot;p/trn001&quot;
  creator: &quot;u/somnaths&quot;
  size: 0.0
  notes: 0
  deps_avail: true
}
, &#39;RecordDataReply&#39;)
</pre></div>
</div>
<p>Upload raw data that will be associated with this Data Record:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">put_resp</span> <span class="o">=</span> <span class="n">df_api</span><span class="o">.</span><span class="n">dataPut</span><span class="p">(</span><span class="n">record_id</span><span class="p">,</span>
                          <span class="s1">&#39;./parameters.json&#39;</span><span class="p">,</span>
                          <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Waits until transfer completes.</span>
                          <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">put_resp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(item {
   id: &quot;d/34682319&quot;
   title: &quot;Some new title for the data&quot;
   size: 0.0
   owner: &quot;p/trn001&quot;
 }
task {
   id: &quot;task/34702491&quot;
   type: TT_DATA_PUT
   status: TS_SUCCEEDED
   client: &quot;u/somnaths&quot;
   step: 3
   steps: 4
   msg: &quot;Finished&quot;
   ct: 1611102437
   ut: 1611102444
   source: &quot;olcf#dtn/gpfs/alpine/stf011/scratch/somnaths/DataFed_Tutorial/raw_data.dat&quot;
   dest: &quot;d/34682319&quot;
 }, &#39;DataPutReply&#39;)
</pre></div>
</div>
<p>More examples are available in the
<a class="reference external" href="https://ornl.github.io/DataFed/user/python/high_level_guide.html#getting-started">user guide</a> and in <a class="reference external" href="https://ornl.github.io/DataFed/user/python/notebooks.html">Jupyter notebooks</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="containers.html" class="btn btn-neutral float-right" title="Containers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Cross Facility Workflows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, ALCF, OLCF, NERSC.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>